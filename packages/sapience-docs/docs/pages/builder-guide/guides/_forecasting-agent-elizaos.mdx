## ElizaOS Forecasting Agent

<div style={{ display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap', marginBottom: '1rem' }}>
  <a href="https://github.com/sapiencexyz/sapience/tree/main/starters/elizaos">
    <img alt="ElizaOS Starter on GitHub" src="https://img.shields.io/badge/ElizaOS%20Starter-sapiencexyz%2Fsapience-181717?logo=github" />
  </a>
</div>

The [ElizaOS starter](https://github.com/sapiencexyz/sapience/tree/main/starters/elizaos) provides a complete autonomous forecasting agent built with the [ElizaOS framework](https://elizaos.ai/). Enable forecasting by setting `ENABLE_AUTONOMOUS_ATTESTATION=true`.

### One-Click Deploy

Deploy on [Railway](https://railway.com/) in minutes:

[![Deploy on Railway](https://railway.com/button.svg)](https://railway.com/deploy/37cOsV?referralCode=WBE0eo&utm_medium=integration&utm_source=template&utm_campaign=generic)

### Environment Variables

For setup details on your API keys and private key, see Get Started: [OpenRouter setup](/builder-guide/getting-started/get-started#openrouter-setup) and [Private key generation](/builder-guide/getting-started/get-started#private-key-generation).

#### Required Environment Variables

| Variable | Notes |
| --- | --- |
| `OPENROUTER_API_KEY` | Your OpenRouter API key for model access |
| `EVM_PRIVATE_KEY` or `ETHEREUM_PRIVATE_KEY` | Private key for publishing forecasts to EAS and executing trades |

#### Default Behavior

The agent runs with these features by default:
- **Auction Trading**: Enabled by default - places bundled wagers based on high-confidence predictions
- **Autonomous Attestation**: Enabled by default via character settings - generates and publishes forecasts automatically (can be controlled via `ENABLE_AUTONOMOUS_ATTESTATION`)

#### Core Configuration (Optional)

| Variable | Default | Notes |
| --- | --- | --- |
| `EVM_PROVIDER_URL` | `https://arb1.arbitrum.io/rpc` | Arbitrum RPC endpoint (consider paid provider for reliability) |
| `ENABLE_AUTONOMOUS_ATTESTATION` | `false` | Enable autonomous attestation mode (requires explicit enabling) |
| `ENABLE_PARLAY_TRADING` | `false` | Enable automated auction trading based on forecasts (legacy variable name) |

#### Attestation Configuration (Optional)

| Variable | Default | Notes |
| --- | --- | --- |
| `ATTESTATION_INTERVAL_MS` | `300000` | Cycle interval in milliseconds (5 minutes) |
| `MIN_ATTESTATION_CONFIDENCE` | `0.6` | Minimum confidence threshold (0-1) for attestations |
| `ATTESTATION_BATCH_SIZE` | `5` | Number of markets to process per cycle |
| `PROBABILITY_CHANGE_THRESHOLD` | `10` | Percentage change required for re-attestation |
| `MIN_HOURS_BETWEEN_ATTESTATIONS` | `24` | Hours between attestations on same market |

#### Auction Trading Configuration (Optional)

> Environment variables retain the `PARLAY_*` prefix for backward compatibility but control auction-style trading.

| Variable | Default | Notes |
| --- | --- | --- |
| `PARLAY_WAGER_AMOUNT` | `1000000000000000000` | Wager amount in USDe (18 decimals: $1) |
| `MIN_PARLAY_CONFIDENCE` | `0.6` | Minimum confidence for bundled predictions |
| `MIN_HOURS_BETWEEN_PARLAYS` | `24` | Minimum hours between auction attempts |
| `MIN_PARLAY_PREDICTION_CHANGE` | `10` | Percentage change required before opening another auction |
| `PARLAY_MARKETS_FETCH_LIMIT` | `100` | Number of markets to fetch from GraphQL |
| `PARLAY_MARKETS_SKIP` | `0` | Number of markets to skip in GraphQL query |
| `PARLAY_AUCTION_TIMEOUT_MS` | `300000` | Auction timeout in milliseconds (5 minutes) |
| `PARLAY_KEEPALIVE_INTERVAL_MS` | `20000` | WebSocket keepalive interval (20 seconds) |
| `PARLAY_STATUS_INTERVAL_MS` | `30000` | Status update interval (30 seconds) |

#### Contract Addresses (Optional)

| Variable | Default | Notes |
| --- | --- | --- |
| `UMA_RESOLVER_ADDRESS` | `0x2cc1311871b9fc7bfcb809c75da4ba25732eafb9` | UMA resolver contract |
| `PREDICTION_MARKET_ADDRESS` | `0xb04841cad1147675505816e2ec5c915430857b40` | PredictionMarket contract |
| `USDE_TOKEN_ADDRESS` | `0xfEb8C4d5eFbaFf6e928eA090Bc660c363f883DBA` | USDe collateral token |
| `USDE_APPROVAL_AMOUNT` | `1000000000000000000000000` | Token approval amount (1M USDe) |

#### API Endpoints (Optional)

| Variable | Default | Notes |
| --- | --- | --- |
| `SAPIENCE_WS_URL` | `wss://api.sapience.xyz/auction` | WebSocket endpoint for auctions |
| `SAPIENCE_GRAPHQL_URL` | `https://api.sapience.xyz/graphql` | GraphQL endpoint for market data |

### Customize Your Agent

We strongly recommend using an [LLM-powered code editor](/builder-guide/getting-started/get-started) to customize your agent.

#### Eject to your GitHub and pull locally

First, connect the deployed service to your own repository so you can edit and push changes.
Second, make sure your github account is connected and authorized. You can find this at Account Settings -> Account -> Account Integrations -> Configure Railway App. If you don't have the railway app configured on your account it will not let you eject to your github account.

1. In Railway, open your service -> Source -> Eject -> choose your GitHub org -> Eject service
2. Clone the newly created repo and set up locally:

```bash
git clone <your-new-repo-url> your-forecast-agent
cd your-forecast-agent
# install deps (choose your tool)
bun install # or: pnpm install / npm install
cp .env.example .env
# Required: OpenRouter API key for LLM access
# OPENROUTER_API_KEY=<your-openrouter-api-key>

# Required: Private key for on-chain attestations and trading
# EVM_PRIVATE_KEY=<your-ethereum-private-key>

# Optional: Enable autonomous attestations
# ENABLE_AUTONOMOUS_ATTESTATION=true

# Optional: Enable automated auction trading
# ENABLE_PARLAY_TRADING=true
```

3. Push changes; enable Autodeploy in Railway so pushes redeploy automatically.

#### Edit Your Agent's Code

You'll customize prompts and model selection. The template/Eliza runtime handles formatting, routing, and output normalization.

1. Edit prompts/persona in `src/character.ts`: Update `name`, `bio`, `lore`, `style`, etc - this is your system prompt. Add domain context and instructions for producing a single percent chance (0-100%) for Yes/No markets.

2. Choose/override the model: Set environment in Railway (recommended): Preferred: `OPENAI_BASE_URL=https://openrouter.ai/api/v1`, set `OPENAI_API_KEY` to your OpenRouter key, and choose a model id (e.g. `openai/gpt-4o-mini`). Direct providers: You may instead use OpenAI/Anthropic keys with their native SDKs, but OpenRouter unifies models and billing. If the template pins a model in code, update the LLM provider in `src/index.ts` to your desired model/provider.

3. Verify outputs and iterate quickly: Keep structured logs on; each run should show the chosen market, your percent forecast, and (if enabled) the EAS attestation hash. Tighten prompts or switch models to improve calibration and stability.

4. Quick edge ideas: Constrain output to a single number with units, e.g., "62%". Lower temperature for stability; compare small models for cost vs. quality. Add lightweight retrieval (e.g., headlines) if supported by the template. Track a rolling window of forecasts to see variance and bias.

5. Wire invocation behavior in `src/index.ts`: Ensure your forecasting action/provider is registered so it can run on a schedule or on command. Keep logs enabled to inspect inputs/outputs and iterate quickly.

6. Tune market selection: Default: queries Sapience for open markets, sorts by soonest `endTimestamp`, and picks the next closing market; de-duplicates by group when present. Tweak: filter by topic/category via environment, pin a specific market or group, or swap the selection provider/action in `src/index.ts`. Logs include `marketId`, `groupId` (if present), and `endTimestamp` so you can verify behavior.

#### Run Locally

Local development (example with Bun):

```bash
# after Eject, clone your repo (replace with your URL)
git clone <your-new-repo-url> your-forecast-agent
cd your-forecast-agent
bun install
cp .env.example .env
# Required: OpenRouter API key for LLM access
# OPENROUTER_API_KEY=<your-openrouter-api-key>

# Required: Private key for on-chain attestations and trading
# EVM_PRIVATE_KEY=<your-ethereum-private-key>

# Optional: Enable autonomous attestations  
# ENABLE_AUTONOMOUS_ATTESTATION=true

# Optional: Enable automated auction trading
# ENABLE_PARLAY_TRADING=true
bun run dev
```

Looking to deploy manually? See the Railway CLI guide: [Deploy with the CLI](https://docs.railway.com/guides/cli).

### Advanced Features

#### Autonomous Attestation Mode

The agent can automatically generate and publish forecasts on a schedule. While the character settings enable autonomous mode by default, the attestation service requires explicit enabling:

1. **Enable Autonomous Mode** (if not already enabled):
```bash
ENABLE_AUTONOMOUS_ATTESTATION=true
```

2. **Configure Attestation Behavior** (optional):
```bash
# Cycle interval in milliseconds (5 minutes default)
ATTESTATION_INTERVAL_MS=300000

# Minimum confidence for publishing attestations
MIN_ATTESTATION_CONFIDENCE=0.6

# Number of markets to process per cycle
ATTESTATION_BATCH_SIZE=5

# Only re-attest if probability changed by this percentage
PROBABILITY_CHANGE_THRESHOLD=10

# Minimum hours between attestations on same market
MIN_HOURS_BETWEEN_ATTESTATIONS=24
```

3. **Operational Behavior**:
   - **Frequency**: Runs every 5 minutes by default (configurable via `ATTESTATION_INTERVAL_MS`)
   - **Batch processing**: Analyzes up to 5 markets per cycle
   - **De-duplication**: Won't re-attest the same market within 24 hours unless probability changes by more than 10%
   - **Log monitoring**: Look for `Attested condition` messages with transaction hashes
   - **Code reference**: [View attestation service](https://github.com/sapiencexyz/sapience/blob/main/starters/elizaos/src/services/attestationService.ts)

#### Automated Auction Trading

Your forecasting agent can automatically place bundled prediction-market trades through the Sapience auction rail:

- **3+ High-Confidence Markets** -> Opens an auction request
- **Prediction greater than 50%** -> YES position
- **Prediction less than 50%** -> NO position

##### Setup Auction Trading

1. **Enable Trading** by setting the environment variable:
```bash
ENABLE_PARLAY_TRADING=true  # Legacy variable name for auction trading
```

2. **Configure Trading Parameters** (optional):
```bash
# Wager amount in USDe (18 decimals)
PARLAY_WAGER_AMOUNT=1000000000000000000  # $1 default

# Minimum confidence for bundled predictions
MIN_PARLAY_CONFIDENCE=0.6

# Hours between auction attempts
MIN_HOURS_BETWEEN_PARLAYS=24

# Percentage change required before opening another auction
MIN_PARLAY_PREDICTION_CHANGE=10
```

3. **Advanced Configuration**:
```bash
# Number of markets to fetch from GraphQL
PARLAY_MARKETS_FETCH_LIMIT=100

# Auction timeout (5 minutes default)
PARLAY_AUCTION_TIMEOUT_MS=300000

# WebSocket keepalive interval
PARLAY_KEEPALIVE_INTERVAL_MS=20000
```

4. **Ensure Wallet Funding**: Your `ETHEREUM_PRIVATE_KEY` wallet needs USDe on Arbitrum for trading.

##### How Auction Trading Works

The agent analyzes prediction markets and executes bundled trades when conditions are met:

1. **Market Analysis**: Fetches active conditions from the Sapience GraphQL API
2. **Prediction Generation**: Creates probability forecasts for eligible markets
3. **Bundle Selection**: Identifies 3+ high-confidence predictions to trade together
4. **Auction Creation**: Starts an auction via WebSocket as maker
5. **Bid Acceptance**: Automatically accepts the best bid from market makers
6. **Transaction Execution**: Approves USDe token spending, calls `PredictionMarket.mint()` with auction parameters, and reports the transaction hash upon success

##### Timing & Operational Details

**Execution Frequency:**
- Auction opportunities are checked every attestation cycle (default: every 5 minutes)
- Maximum one auction attempt per 24 hours (prevents overtrading)
- Each auction stays open for 5 minutes waiting for takers

**What to Monitor:**
- Log messages indicating how many bundled conditions were found
- Successful trades: Look for transaction hashes in logs
- Failed attempts: The bot retries after the cooldown period

**Code Reference:** [View the auction trading implementation](https://github.com/sapiencexyz/sapience/blob/main/starters/elizaos/src/actions/parlayTradingAction.ts)

##### Architecture Overview

The auction trading system uses a modular architecture:

- **Helper Modules**: Centralized blockchain, contract, and pricing utilities
- **Environment-Driven**: All parameters configurable via environment variables
- **Contract Integration**: Direct interaction with Arbitrum contracts
- **WebSocket Auctions**: Real-time auction participation
- **Rate Limiting**: Prevents excessive trading with time-based controls
