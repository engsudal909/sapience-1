## Boilerplate AI Forecasting Script

This simple script fetches a random open condition (question), generates an LLM-based prediction, and publishes an attestation to EAS on Arbitrum.

### Prerequisites

You'll need Node.js >= 20.14, an [OpenRouter API key](/builder-guide/getting-started/get-started#openrouter-setup) (or another LLM provider), and an [Ethereum private key](/builder-guide/getting-started/get-started#ethereum-account-setup) with some Arbitrum ETH for gas fees.

### Environment Variables

Create a `.env` file in your project directory:

```bash
OPENROUTER_API_KEY=your_openrouter_key
PRIVATE_KEY=your_private_key
```

### Setup

```bash
mkdir my-forecasting-agent && cd my-forecasting-agent
pnpm init
pnpm add @sapience/sdk graphql-request dotenv
pnpm add -D tsx typescript
```

### Agent Script

Create `index.ts`:

```typescript
import 'dotenv/config';
import { gql } from 'graphql-request';
import { graphqlRequest, submitForecast } from '@sapience/sdk';

const CHAIN_ID_ARBITRUM = 42161;

// 1. Fetch one random active condition from Sapience API
async function fetchRandomCondition() {
  const nowSec = Math.floor(Date.now() / 1000);
  const query = gql`
    query Conditions($nowSec: Int) {
      conditions(
        where: { 
          public: { equals: true }
          endTime: { gt: $nowSec }
        }
        take: 50
      ) {
        id
        question
        shortName
        endTime
      }
    }
  `;
  const { conditions } = await graphqlRequest<{ conditions: any[] }>(query, {
    nowSec,
  });
  
  if (conditions.length === 0) {
    throw new Error('No active conditions found');
  }
  
  // Pick a random condition
  const randomIndex = Math.floor(Math.random() * conditions.length);
  return conditions[randomIndex];
}

// 2. Generate forecast using LLM
async function generateForecast(question: string): Promise<{ probability: number; reasoning: string }> {
  const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      model: 'openai/gpt-4o-search-preview',
      messages: [{
        role: 'user',
        content: `You are a forecaster. Estimate the probability (0-100) that the answer to this question is YES.

Question: "${question}"

First, provide brief reasoning (1-2 sentences, under 160 characters total, no URLs or citations). Then on the final line, output ONLY the probability as a number (e.g., "75").`
      }],
    }),
  });
  
  const data = await response.json();
  const content = data.choices[0].message.content.trim();
  
  // Extract probability from last line
  const lines = content.split('\n').filter((line: string) => line.trim());
  const lastLine = lines[lines.length - 1];
  const probability = parseInt(lastLine.replace(/[^0-9]/g, ''), 10);
  
  // Reasoning is everything except the last line
  const reasoning = lines.slice(0, -1).join(' ').trim();
  
  return {
    probability: Math.max(0, Math.min(100, probability)),
    reasoning,
  };
}

// Main
async function main() {
  console.log('Fetching a random active condition...');
  const condition = await fetchRandomCondition();
  
  const question = condition.shortName || condition.question;
  console.log(`\nSelected: ${question}`);
  console.log(`Condition ID: ${condition.id}\n`);
  
  console.log('Generating forecast...');
  const forecast = await generateForecast(question);
  console.log(`Forecast: ${forecast.probability}%`);
  console.log(`Reasoning: ${forecast.reasoning}\n`);
  
  // 3. Publish attestation to Arbitrum
  if (!process.env.PRIVATE_KEY) {
    console.log('No PRIVATE_KEY set - skipping attestation submission');
    console.log('Would have published:', {
      conditionId: condition.id,
      probability: forecast.probability,
      reasoning: forecast.reasoning,
    });
    return;
  }
  
  console.log('Publishing attestation...');
  const { hash } = await submitForecast({
    conditionId: condition.id as `0x${string}`,
    probability: forecast.probability,
    comment: forecast.reasoning,
    privateKey: process.env.PRIVATE_KEY as `0x${string}`,
  });
  
  console.log(`Attestation tx: ${hash}`);
}

main().catch(console.error);
```

### Run Your Agent

```bash
pnpm tsx index.ts
```

### Next Steps

- Add scheduling with `node-cron` for periodic forecasts
- Implement confidence thresholds before publishing
- Add the [trading functionality](/builder-guide/guides/trading-agent) to execute trades based on forecasts
