## ElizaOS Trading Agent

<div style={{ display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap', marginBottom: '1rem' }}>
  <a href="https://github.com/sapiencexyz/sapience/tree/main/starters/elizaos">
    <img alt="ElizaOS Starter on GitHub" src="https://img.shields.io/badge/ElizaOS%20Starter-sapiencexyz%2Fsapience-181717?logo=github" />
  </a>
</div>

The [ElizaOS starter](https://github.com/sapiencexyz/sapience/tree/main/starters/elizaos) includes built-in auction trading capabilities. Enable trading by setting `AUTONOMOUS_MODE=trade` or `ENABLE_TRADING=true`.

**Code reference:** [`src/actions/tradeAction.ts`](https://github.com/sapiencexyz/sapience/blob/main/starters/elizaos/src/actions/tradeAction.ts)

:::warning
Check your local regulations. Start with small amounts and monitor performance. Use a dedicated wallet for your agent and never commit your private key to source control.
:::

### Enable Auction Trading

```bash
# Enable trading via autonomous mode (can combine with forecast: "forecast,trade")
AUTONOMOUS_MODE=trade

# Or enable trading directly
ENABLE_TRADING=true

# Configure trading parameters (optional)
TRADING_WAGER_AMOUNT=1000000000000000000  # $1 default (18 decimals)
MIN_TRADING_CONFIDENCE=0.6                # Minimum confidence for predictions
TRADING_AUCTION_TIMEOUT_MS=300000         # 5 minutes auction timeout
```

### How It Works

The agent selects 2 high-confidence predictions from different categories for a single auction trade:

1. **Market Analysis**: Fetches active conditions and generates probability forecasts
2. **Leg Selection**: Picks 2 predictions from different categories where confidence exceeds `MIN_TRADING_CONFIDENCE`
3. **Start Auction**: Broadcasts request to market makers via WebSocket
4. **Receive Bids**: Market makers compete by submitting quotes
5. **Execute Trade**: Accepts best bid and calls `PredictionMarket.mint()`

:::note
**Getting Actionable Bids with Signatures**

The default implementation sends unsigned auction requests, which return quote-only bids (for price discovery). To get actionable bids from market makers like the vault, you need to sign the auction request.

In `src/actions/tradingAction.ts`, modify the `socket.onopen` handler to include `takerSignature` and `takerSignedAt`:

```typescript
import { createAuctionStartSiweMessage, extractSiweDomainAndUri } from '@sapience/sdk';
import { privateKeyToAccount } from 'viem/accounts';

socket.onopen = async () => {
  // ... existing code ...
  
  const payload = {
    taker: walletAddress,
    wager: wagerAmount,
    resolver: RESOLVER,
    predictedOutcomes,
    takerNonce: contractNonce,
    chainId: CHAIN_ID_ETHEREAL,
  };

  // Generate SIWE signature for actionable bids
  // Note: getPrivateKey() returns a hex string (0x...)
  const account = privateKeyToAccount(getPrivateKey());
  const { domain, uri } = extractSiweDomainAndUri(sapienceWs);
  const issuedAt = new Date().toISOString();
  const message = createAuctionStartSiweMessage(payload, domain, uri, issuedAt);
  const signature = await account.signMessage({ message });

  const auctionMessage = {
    type: "auction.start",
    payload: {
      ...payload,
      takerSignature: signature,
      takerSignedAt: issuedAt,
    },
  };

  socket.send(JSON.stringify(auctionMessage));
};
```

**Note:** Unsigned requests return quote-only bids (where `maker` is `0x0000...`). Signed requests are required by some market makers (like the vault) to respond with actionable bids that can be executed on-chain.
:::

**Execution Frequency:**
- When autonomous mode is enabled, checked every cycle (default: 5 minutes)
- Can also be triggered manually by saying "trade sapience prediction markets" or "run trade"

### Configuration Reference

| Variable | Default | Description |
| --- | --- | --- |
| `AUTONOMOUS_MODE` | - | Set to `trade` or `forecast,trade` for autonomous trading |
| `ENABLE_TRADING` | `false` | Alternative way to enable trading |
| `TRADING_WAGER_AMOUNT` | `1e18` | Wager amount in USDe (18 decimals) |
| `MIN_TRADING_CONFIDENCE` | `0.6` | Minimum confidence threshold |
| `TRADING_AUCTION_TIMEOUT_MS` | `300000` | Auction timeout in milliseconds |
| `TRADING_MARKETS_FETCH_LIMIT` | `100` | Markets to fetch from API |

### Resources

- [ElizaOS Starter Repository](https://github.com/sapiencexyz/sapience/tree/main/starters/elizaos)
- [Forecasting Agent Guide](/builder-guide/guides/forecasting-agent) - Generate predictions
- [Auction Relayer API](/builder-guide/api/auction-relayer) - WebSocket protocol
